<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>Dynamic Knockd :: Travis Chen — an engineer of the software persuasion</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="description" content="tl;dr: service to continuously change port sequence for knockd.
Available on GitHub.
This is a service that will dynamically update the knock sequence used by knockd. In essence, we update the knock sequence and restart knockd at regular intervals (configurable), thereby increasing security. The way the knock sequence is generated will depend on which script is used for generating them. The basic layout of this repository is as follows:
 generators/: stores different scripts that generate knock sequences update." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://everchanging.dev/projects/dynamic-knockd/" />




<link rel="stylesheet" href="/assets/style.css">

  <link rel="stylesheet" href="/assets/blue.css">






<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/img/apple-touch-icon-144-precomposed.png">

  <link rel="shortcut icon" href="/icons/top-hat.png">



<meta name="twitter:card" content="summary" />

<meta name="twitter:creator" content="" />


<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Dynamic Knockd :: Travis Chen">
<meta property="og:description" content="service to continuously change port sequence for knockd" />
<meta property="og:url" content="https://everchanging.dev/projects/dynamic-knockd/" />
<meta property="og:site_name" content="Dynamic Knockd" />

  
    <meta property="og:image" content="/icons/top-hat.png">
  

<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">


  <meta property="article:published_time" content="2019-09-09 16:32:43 -0700 -0700" />










<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />



</head>
<body class="">


<div class="container headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      
<a href="/">
  <div class="logo menu__inner--desktop">
    everchanging.dev
  </div>
  <div class="logo menu__inner--mobile">
    <div class="fa fa-home"></div>
  </div>
</a>


  
  <div class="logo">
    <a href="https://github.com/directed-graph" title="Github" class="fa fa-github"></a>
  </div>
  
  <div class="logo">
    <a href="https://linkedin.com/in/travischen" title="LinkedIn" class="fa fa-linkedin"></a>
  </div>
  



    </div>
    <div class="menu-trigger">menu</div>
  </div>
  
    <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/">home</a></li>
        
      
        
          <li><a href="/projects">projects</a></li>
        
      
        
          <li><a href="/posts">posts</a></li>
        
      
        
          <li><a href="/about">about</a></li>
        
      
    

    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/">home</a></li>
      
    
      
        <li><a href="/projects">projects</a></li>
      
    
      
        <li><a href="/posts">posts</a></li>
      
    
      
        <li><a href="/about">about</a></li>
      
    
    
  </ul>
</nav>

  
</header>


  <div class="content">
    
<div class="post">
  <h1 class="post-title">
    <a href="https://everchanging.dev/projects/dynamic-knockd/">Dynamic Knockd</a></h1>
  <div class="post-meta">
      
    <span class="post-date">
      2019-09-09
    </span>
    
    
  </div>

  
  <span class="post-tags">
    
    #<a href="/tags/projects/">projects</a>&nbsp;
    
    #<a href="/tags/infosec/">infosec</a>&nbsp;
    
  </span>
  

  

  <div class="post-content"><div>
        <p><em>tl;dr</em>: service to continuously change port sequence for knockd.</p>
<p>Available on <a href="https://github.com/directed-graph/dynamic-knockd">GitHub</a>.</p>
<p>This is a service that will dynamically update the knock sequence used by
<code>knockd</code>. In essence, we update the knock sequence and restart <code>knockd</code> at
regular intervals (configurable), thereby increasing security. The way the
knock sequence is generated will depend on which script is used for generating
them. The basic layout of this repository is as follows:</p>
<ul>
<li><code>generators/</code>: stores different scripts that generate knock sequences</li>
<li><code>update.bash</code>: script to update the knock sequence and restart <code>knockd</code></li>
</ul>
<h2 id="generator-scripts">Generator Scripts<a href="#generator-scripts" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>Each generator script under <code>generators/</code> only has two responsibilities:</p>
<ul>
<li>generate port numbers</li>
<li>generate protocol (optional)</li>
</ul>
<p>The output should be on a per-line basis. For example:</p>
<pre><code>12345
23456:tcp
34567:udp
</code></pre>
<h2 id="updater-script">Updater Script<a href="#updater-script" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>If this service is to be deployed, the <code>update.bash</code> script can be integrated
with a <code>systemd</code> timer. The <code>update.bash</code> script will call the generator script
that is given as input, and write the results to the knock sequence file.
Because <code>knockd</code> will &ldquo;cross out&rdquo; a sequence after using it, we need to write
the desired sequence multiple times into the sequence file for each interval. As
such, we must replace the whole file after each interval.</p>
<h2 id="configuration">Configuration<a href="#configuration" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>All configuration for <code>dynamic-knockd</code> should be done via environment variables
(which can be set using the <code>Environment=</code> directive in the case of a <code>systemd</code>
module). Each generator script can have different environmental configurations,
so you should set them based on the generator script you are using.</p>
<p>Configuration for <code>knockd</code> itself should still be done through
<code>/etc/knockd.conf</code>. Note that you need to set the following:</p>
<pre><code>one_time_sequences = $BASE_PREFIX/etc/sequence
</code></pre>
<p>Where, by default, <code>$BASE_PREFIX</code> is <code>/opt/dynamic-knockd</code>.</p>
<h2 id="installation">Installation<a href="#installation" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>Generally, you can clone this repository to <code>/opt/dynamic-knockd</code>, and copy the
<code>systemd</code> files as appropriate to use it. We have provided a <code>Makefile</code> for
convenience. Note that if you modify the <code>*_PREFIX</code> values, you may need to
manually modify some paths as well. The basic installation syntax is as follows:</p>
<pre><code>make [BASE_PREFIX=...] [SYSTEMD_PREFIX=...] [all|base|systemd]
</code></pre>
<p>There is no need to compile. Not specifying a recipe will print a message and
do nothing. Installing <code>all</code> will install both <code>base</code> and <code>systemd</code>. Installing
<code>base</code> will put the base scripts (<code>generators/*</code> and <code>update.bash</code>) into
<code>BASE_PREFIX</code> (<code>/opt/dynamic-knockd</code> by default). Installing <code>systemd</code> will put
the <code>systemd/*</code> files into <code>SYSTEMD_PREFIX</code> (<code>/usr/local/lib/systemd/system</code> by
default). Note that you will need to run as root for these default options.</p>

      </div></div>

  
  
<div class="pagination">
    <div class="pagination__title">
        <span class="pagination__title-h">Read other posts</span>
        <hr />
    </div>
    <div class="pagination__buttons">
        
        <span class="button previous">
            <a href="/projects/prompt-framework/">
                <span class="button__icon">←</span>
                <span class="button__text">Prompt Framework</span>
            </a>
        </span>
        
        
        <span class="button next">
            <a href="/projects/texts-to-passphrase/">
                <span class="button__text">Texts to Passphrase</span>
                <span class="button__icon">→</span>
            </a>
        </span>
        
    </div>
</div>


  

  

</div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">
        <span>© Travis Chen</span>
    
      </div>
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>





  
</div>

</body>
</html>
